# Solana Test Environment with Google BigTable Emulator

This repository contains a Docker-based setup for a Solana test environment integrated with a Google BigTable emulator. The environment includes 8 main services:

## Services Overview

1. **BigTable Emulator**:
    - Simulates Google BigTable for local testing without needing to interact with Google Cloud.
    - **Port**: `8086`
    - **Start Command**: `docker compose up bigtable-emulator --build`

2. **Solana Test Validator**:
    - A custom Solana Warehouse test node that generates a local network and simulates transactions while uploading them to either the BigTable emulator or the Solana Bigtable HBase Adapter.
    - **Start Command**: `docker compose up validator --build`
    - **Environment Variable**: Set `BIGTABLE_EMULATOR_HOST` to either `bigtable-emulator:8086` or `solana-bigtable-hbase-adapter:50051` depending on your setup.

3. **Syncer**:
    - A service responsible for migrating data from BigTable or local files to Tencent Cloud Storage in sequencefiles format.
    - **Start Command**:
        - For BigTable: `docker compose up syncer-bigtable --build`
        - For Local Files: `docker compose up syncer-local-files --build`
    - **Configuration**: Update `config.properties` with the necessary Tencent Cloud Storage credentials and other settings.

4. **HBase**:
    - A Hadoop database that can be used to import the sequencefiles generated by the Syncer.
    - **Ports**: `16010`, `16020`, `16030`, `2181`, `9090`
    - **Start Command**: `docker compose up hbase --build`

5. **Solana Lite RPC**:
    - A Solana RPC server that can be used to query the Solana network from both BigTable and HBase.
    - **Ports**: `8899`, `8900`
    - **Start Command**: `docker compose up solana-lite-rpc --build`

6. **Bigtable to HBase Adapter**:
    - Mimics the Google BigTable interface, allowing Solana nodes to write data directly to HBase instead of BigTable.
    - **Port**: `50051`
    - **Start Command**: `docker compose up solana-bigtable-hbase-adapter --build`
    - **Environment Variable**: Set `HBASE_HOST` to `hbase:9090`.

7. **MinIO**:
    - A high-performance, S3-compatible object storage service that can be used as an alternative storage for testing.
    - **Ports**: `9000`, `9001`
    - **Start Command**: `docker compose up minio --build`
    - **Healthcheck**: Configured to ensure the service is running properly.

8. **MinIO Bucket Setup**:
    - Sets up the MinIO bucket and applies public access policies.
    - **Start Command**: `docker compose up minio-bucket-setup`

## Requirements
- Docker Compose V2

## Usage

### There are multiple setups in this repository:

1. **Solana Node writing to HBase instead of BigTable**
    - **Steps**:
        1. Start the HBase and Adapter services:
           ```bash
           docker compose up hbase --build
           docker compose up solana-bigtable-hbase-adapter --build
           ```
        2. Run the Solana Test Validator with the appropriate `BIGTABLE_EMULATOR_HOST` environment variable:
           ```bash
           docker compose up validator --build
           ```
        3. The Solana Test Validator will now write data to HBase instead of BigTable. Use the Solana Lite RPC to query the data or exec into the HBase container to run HBase shell commands:
           ```bash
           docker exec -it <hbase_container_id> /bin/bash
           ```

2. **Syncer reading files written by [GeyserPlugin](https://github.com/bwarelabs/solana-cos-plugin) to Tencent Cloud Storage in sequencefiles format**
    - **Steps**:
        1. Update `config.properties` with Tencent Cloud Storage credentials.
        2. Start the Syncer service with the `read-source=local-files` command:
           ```bash
           docker compose up syncer-local-files --build
           ```
        3. The Syncer will read local files and upload them to Tencent Cloud Storage.

3. **Syncer migrating data from BigTable to Tencent Cloud Storage in sequencefiles format**
    - **Steps**:
        1. Ensure your `config.properties` is updated with Tencent Cloud Storage credentials.
        2. If using the BigTable Emulator, make sure you have data in BigTable. If not, generate some by running the Solana Test Validator and BigTable Emulator:
           ```bash
           docker compose up bigtable-emulator --build
           docker compose up validator --build
           ```
        3. Start the Syncer service with the `read-source=bigtable` command:
           ```bash
           docker compose up syncer-bigtable --build
           ```
        4. The Syncer will migrate data from BigTable to Tencent Cloud Storage in sequencefiles format.

## Additional Notes
- **MinIO Setup**: If you wish to use MinIO for object storage, ensure MinIO and MinIO Bucket Setup services are started:
  ```bash
  docker compose up minio --build
  docker compose up minio-bucket-setup --build
