# Solana Test Environment with Google BigTable Emulator

This repository contains a Docker-based setup for a Solana test environment integrated with a Google BigTable emulator. The environment includes 6 main services:

1. **BigTable Emulator**: Simulates Google BigTable for local testing without needing to interact with Google Cloud.
2. **Solana Test Validator**: A custom Solana Warehouse test node that generates a local network and simulates transactions while uploading them to the BigTable emulator.
3. **Syncer**: https://github.com/bwarelabs/solana-syncer
4. **HBase**: A Hadoop database that can be used to import the sequencefiles generated by the Syncer.
5. **Solana Lite RPC**: A Solana RPC server that can be used to query the Solana network from both BigTable and HBase.
6. **Bigtable to HBase Adapter**: https://github.com/bwarelabs/solana-bigtable-hbase-adapter

The setup is ideal for development and testing of migration Solana from Google BigTable to HBase. Cheack each service's folder for more information.

# Usage
## There are multiple setups in this repository:
1. **Solana Node writing to HBase instead of BigTable**
2. **Syncer reading files written by [GeyserPlugin](https://github.com/bwarelabs/solana-cos-plugin) to Tencent Cloud Storage in sequencefiles format**
3. **Syncer migrating data from BigTable to Tencent Cloud Storage in sequencefiles format**

## Setup 1: Solana Node writing to HBase instead of BigTable
1. Make sure you have hbase and adapter services running. You can use `docker compose up hbase --build` and `docker compose up adapter --build` to start them.
2. Create the required tables in HBase `blocks`, `entries`, `tx`, `tx-by-addr`. Check HBase's readme for more information.
3. Run the Solana Test Validator using docker compose as well, but make sure that the `BIGTABLE_EMULATOR_HOST` environment variable is set to `solana-bigtable-hbase-adapter:50051` (see docker-compose).
4. The Solana Test Validator will now write data to HBase instead of BigTable. You can use the Solana Lite RPC to query the data or exec into the HBase container to run HBase shell commands.

## Setup 3: Syncer migrating data from BigTable to Tencent Cloud Storage in sequencefiles format
1. You will need tencent cloud storage credentials and a few configs depending on the data you want to migrate. Check `config.properties` for the required properties.
2. Make sure you have data in BigTable. If not, you can generate some data by running the Solana Test Validator and the BigTable Emulator. The `BIGTABLE_EMULATOR_HOST` environment variable should be set to `bigtable-emulator:8086` (see docker-compose).
3. Start the Syncer service using `docker compose up syncer --build`. The Syncer will read data from BigTable and write it to Tencent Cloud Storage in sequencefiles format. Check the Syncer's readme for more information.
4. Check `cos-cli` documentation for more information on how to interact with Tencent Cloud Storage.